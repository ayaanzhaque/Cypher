<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Browser speech recognition</title>

    <link
      href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css" />
    <link rel="stylesheet" href="css/animate.css" />

    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="css/magnific-popup.css" />

    <link rel="stylesheet" href="css/aos.css" />

    <link rel="stylesheet" href="css/ionicons.min.css" />

    <link rel="stylesheet" href="css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="css/jquery.timepicker.css" />

    <link rel="stylesheet" href="css/flaticon.css" />
    <link rel="stylesheet" href="css/icomoon.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="shortcut icon" type="image/png" href="images/favicon.png"/>

    <style>
      /****************************************************************
 *
 * CSS Percentage Circle
 * Author: Andre Firchow
 *
*****************************************************************/
/****************************************************************
 *
 * CSS Percentage Circle
 * Author: Andre Firchow
 *
*****************************************************************/
.rect-auto, .c100.p51 .slice, .c100.p52 .slice, .c100.p53 .slice, .c100.p54 .slice, .c100.p55 .slice, .c100.p56 .slice, .c100.p57 .slice, .c100.p58 .slice, .c100.p59 .slice, .c100.p60 .slice, .c100.p61 .slice, .c100.p62 .slice, .c100.p63 .slice, .c100.p64 .slice, .c100.p65 .slice, .c100.p66 .slice, .c100.p67 .slice, .c100.p68 .slice, .c100.p69 .slice, .c100.p70 .slice, .c100.p71 .slice, .c100.p72 .slice, .c100.p73 .slice, .c100.p74 .slice, .c100.p75 .slice, .c100.p76 .slice, .c100.p77 .slice, .c100.p78 .slice, .c100.p79 .slice, .c100.p80 .slice, .c100.p81 .slice, .c100.p82 .slice, .c100.p83 .slice, .c100.p84 .slice, .c100.p85 .slice, .c100.p86 .slice, .c100.p87 .slice, .c100.p88 .slice, .c100.p89 .slice, .c100.p90 .slice, .c100.p91 .slice, .c100.p92 .slice, .c100.p93 .slice, .c100.p94 .slice, .c100.p95 .slice, .c100.p96 .slice, .c100.p97 .slice, .c100.p98 .slice, .c100.p99 .slice, .c100.p100 .slice {
  clip: rect(auto, auto, auto, auto);
}

.pie, .c100 .bar, .c100.p51 .fill, .c100.p52 .fill, .c100.p53 .fill, .c100.p54 .fill, .c100.p55 .fill, .c100.p56 .fill, .c100.p57 .fill, .c100.p58 .fill, .c100.p59 .fill, .c100.p60 .fill, .c100.p61 .fill, .c100.p62 .fill, .c100.p63 .fill, .c100.p64 .fill, .c100.p65 .fill, .c100.p66 .fill, .c100.p67 .fill, .c100.p68 .fill, .c100.p69 .fill, .c100.p70 .fill, .c100.p71 .fill, .c100.p72 .fill, .c100.p73 .fill, .c100.p74 .fill, .c100.p75 .fill, .c100.p76 .fill, .c100.p77 .fill, .c100.p78 .fill, .c100.p79 .fill, .c100.p80 .fill, .c100.p81 .fill, .c100.p82 .fill, .c100.p83 .fill, .c100.p84 .fill, .c100.p85 .fill, .c100.p86 .fill, .c100.p87 .fill, .c100.p88 .fill, .c100.p89 .fill, .c100.p90 .fill, .c100.p91 .fill, .c100.p92 .fill, .c100.p93 .fill, .c100.p94 .fill, .c100.p95 .fill, .c100.p96 .fill, .c100.p97 .fill, .c100.p98 .fill, .c100.p99 .fill, .c100.p100 .fill {
  position: absolute;
  border: 0.08em solid green;
  width: 0.84em;
  height: 0.84em;
  clip: rect(0em, 0.5em, 1em, 0em);
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  -ms-border-radius: 50%;
  -o-border-radius: 50%;
  border-radius: 50%;
  -webkit-transform: rotate(0deg);
  -moz-transform: rotate(0deg);
  -ms-transform: rotate(0deg);
  -o-transform: rotate(0deg);
  transform: rotate(0deg);
}

.pie-fill, .c100.p51 .bar:after, .c100.p51 .fill, .c100.p52 .bar:after, .c100.p52 .fill, .c100.p53 .bar:after, .c100.p53 .fill, .c100.p54 .bar:after, .c100.p54 .fill, .c100.p55 .bar:after, .c100.p55 .fill, .c100.p56 .bar:after, .c100.p56 .fill, .c100.p57 .bar:after, .c100.p57 .fill, .c100.p58 .bar:after, .c100.p58 .fill, .c100.p59 .bar:after, .c100.p59 .fill, .c100.p60 .bar:after, .c100.p60 .fill, .c100.p61 .bar:after, .c100.p61 .fill, .c100.p62 .bar:after, .c100.p62 .fill, .c100.p63 .bar:after, .c100.p63 .fill, .c100.p64 .bar:after, .c100.p64 .fill, .c100.p65 .bar:after, .c100.p65 .fill, .c100.p66 .bar:after, .c100.p66 .fill, .c100.p67 .bar:after, .c100.p67 .fill, .c100.p68 .bar:after, .c100.p68 .fill, .c100.p69 .bar:after, .c100.p69 .fill, .c100.p70 .bar:after, .c100.p70 .fill, .c100.p71 .bar:after, .c100.p71 .fill, .c100.p72 .bar:after, .c100.p72 .fill, .c100.p73 .bar:after, .c100.p73 .fill, .c100.p74 .bar:after, .c100.p74 .fill, .c100.p75 .bar:after, .c100.p75 .fill, .c100.p76 .bar:after, .c100.p76 .fill, .c100.p77 .bar:after, .c100.p77 .fill, .c100.p78 .bar:after, .c100.p78 .fill, .c100.p79 .bar:after, .c100.p79 .fill, .c100.p80 .bar:after, .c100.p80 .fill, .c100.p81 .bar:after, .c100.p81 .fill, .c100.p82 .bar:after, .c100.p82 .fill, .c100.p83 .bar:after, .c100.p83 .fill, .c100.p84 .bar:after, .c100.p84 .fill, .c100.p85 .bar:after, .c100.p85 .fill, .c100.p86 .bar:after, .c100.p86 .fill, .c100.p87 .bar:after, .c100.p87 .fill, .c100.p88 .bar:after, .c100.p88 .fill, .c100.p89 .bar:after, .c100.p89 .fill, .c100.p90 .bar:after, .c100.p90 .fill, .c100.p91 .bar:after, .c100.p91 .fill, .c100.p92 .bar:after, .c100.p92 .fill, .c100.p93 .bar:after, .c100.p93 .fill, .c100.p94 .bar:after, .c100.p94 .fill, .c100.p95 .bar:after, .c100.p95 .fill, .c100.p96 .bar:after, .c100.p96 .fill, .c100.p97 .bar:after, .c100.p97 .fill, .c100.p98 .bar:after, .c100.p98 .fill, .c100.p99 .bar:after, .c100.p99 .fill, .c100.p100 .bar:after, .c100.p100 .fill {
  -webkit-transform: rotate(180deg);
  -moz-transform: rotate(180deg);
  -ms-transform: rotate(180deg);
  -o-transform: rotate(180deg);
  transform: rotate(180deg);
}

.c100 {
  position: relative;
  font-size: 120px;
  width: 1em;
  height: 1em;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  -ms-border-radius: 50%;
  -o-border-radius: 50%;
  border-radius: 50%;
  margin: 0 0.1em 0.1em 0;
  background-color: #cccccc;
}
.c100 *, .c100 *:before, .c100 *:after {
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}
.c100.center {
  float: none;
  margin: 0 auto;
}
.c100.big {
  font-size: 240px;
}
.c100.small {
  font-size: 80px;
}
.c100 > span {
  position: absolute;
  width: 100%;
  z-index: 1;
  left: 0;
  top: 0;
  width: 5em;
  line-height: 5em;
  font-size: 0.2em;
  color: #cccccc;
  display: block;
  text-align: center;
  white-space: nowrap;
  -webkit-transition-property: all;
  -moz-transition-property: all;
  -o-transition-property: all;
  transition-property: all;
  -webkit-transition-duration: 0.2s;
  -moz-transition-duration: 0.2s;
  -o-transition-duration: 0.2s;
  transition-duration: 0.2s;
  -webkit-transition-timing-function: ease-out;
  -moz-transition-timing-function: ease-out;
  -o-transition-timing-function: ease-out;
  transition-timing-function: ease-out;
}
.c100:after {
  position: absolute;
  top: 0.08em;
  left: 0.08em;
  display: block;
  content: " ";
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
  -ms-border-radius: 50%;
  -o-border-radius: 50%;
  border-radius: 50%;
  background-color: whitesmoke;
  width: 0.84em;
  height: 0.84em;
  -webkit-transition-property: all;
  -moz-transition-property: all;
  -o-transition-property: all;
  transition-property: all;
  -webkit-transition-duration: 0.2s;
  -moz-transition-duration: 0.2s;
  -o-transition-duration: 0.2s;
  transition-duration: 0.2s;
  -webkit-transition-timing-function: ease-in;
  -moz-transition-timing-function: ease-in;
  -o-transition-timing-function: ease-in;
  transition-timing-function: ease-in;
}
.c100 .slice {
  position: absolute;
  width: 1em;
  height: 1em;
  clip: rect(0em, 1em, 1em, 0.5em);
}
.c100.p25 .bar {
  -webkit-transform: rotate(90deg);
  -moz-transform: rotate(90deg);
  -ms-transform: rotate(90deg);
  -o-transform: rotate(90deg);
  transform: rotate(90deg);
}

.c100.p75 .bar {
  -webkit-transform: rotate(270deg);
  -moz-transform: rotate(270deg);
  -ms-transform: rotate(270deg);
  -o-transform: rotate(270deg);
  transform: rotate(270deg);
}

.c100:hover {
  cursor: default;
}
.c100:hover > span {
  width: 3.33em;
  line-height: 3.33em;
  font-size: 0.3em;
  color: #aa2020;
}
.c100:hover:after {
  top: 0.04em;
  left: 0.04em;
  width: 0.92em;
  height: 0.92em;
}

/* ______________________________________________________________________________ */

.rect-auto, .c101.p51 .slice, .c101.p52 .slice, .c101.p53 .slice, .c101.p54 .slice, .c101.p55 .slice, .c101.p56 .slice, .c101.p57 .slice, .c101.p58 .slice, .c101.p59 .slice, .c101.p60 .slice, .c101.p61 .slice, .c101.p62 .slice, .c101.p63 .slice, .c101.p64 .slice, .c101.p65 .slice, .c101.p66 .slice, .c101.p67 .slice, .c101.p68 .slice, .c101.p69 .slice, .c101.p70 .slice, .c101.p71 .slice, .c101.p72 .slice, .c101.p73 .slice, .c101.p74 .slice, .c101.p75 .slice, .c101.p76 .slice, .c101.p77 .slice, .c101.p78 .slice, .c101.p79 .slice, .c101.p80 .slice, .c101.p81 .slice, .c101.p82 .slice, .c101.p83 .slice, .c101.p84 .slice, .c101.p85 .slice, .c101.p86 .slice, .c101.p87 .slice, .c101.p88 .slice, .c101.p89 .slice, .c101.p90 .slice, .c101.p91 .slice, .c101.p92 .slice, .c101.p93 .slice, .c101.p94 .slice, .c101.p95 .slice, .c101.p96 .slice, .c101.p97 .slice, .c101.p98 .slice, .c101.p99 .slice, .c101.p100 .slice {
    clip: rect(auto, auto, auto, auto);
  }

  .pie, .c101 .bar, .c101.p51 .fill, .c101.p52 .fill, .c101.p53 .fill, .c101.p54 .fill, .c101.p55 .fill, .c101.p56 .fill, .c101.p57 .fill, .c101.p58 .fill, .c101.p59 .fill, .c101.p60 .fill, .c101.p61 .fill, .c101.p62 .fill, .c101.p63 .fill, .c101.p64 .fill, .c101.p65 .fill, .c101.p66 .fill, .c101.p67 .fill, .c101.p68 .fill, .c101.p69 .fill, .c101.p70 .fill, .c101.p71 .fill, .c101.p72 .fill, .c101.p73 .fill, .c101.p74 .fill, .c101.p75 .fill, .c101.p76 .fill, .c101.p77 .fill, .c101.p78 .fill, .c101.p79 .fill, .c101.p80 .fill, .c101.p81 .fill, .c101.p82 .fill, .c101.p83 .fill, .c101.p84 .fill, .c101.p85 .fill, .c101.p86 .fill, .c101.p87 .fill, .c101.p88 .fill, .c101.p89 .fill, .c101.p90 .fill, .c101.p91 .fill, .c101.p92 .fill, .c101.p93 .fill, .c101.p94 .fill, .c101.p95 .fill, .c101.p96 .fill, .c101.p97 .fill, .c101.p98 .fill, .c101.p99 .fill, .c101.p100 .fill {
    position: absolute;
    border: 0.08em solid red;
    width: 0.84em;
    height: 0.84em;
    clip: rect(0em, 0.5em, 1em, 0em);
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    -ms-border-radius: 50%;
    -o-border-radius: 50%;
    border-radius: 50%;
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
  }

  .pie-fill, .c101.p51 .bar:after, .c101.p51 .fill, .c101.p52 .bar:after, .c101.p52 .fill, .c101.p53 .bar:after, .c101.p53 .fill, .c101.p54 .bar:after, .c101.p54 .fill, .c101.p55 .bar:after, .c101.p55 .fill, .c101.p56 .bar:after, .c101.p56 .fill, .c101.p57 .bar:after, .c101.p57 .fill, .c101.p58 .bar:after, .c101.p58 .fill, .c101.p59 .bar:after, .c101.p59 .fill, .c101.p60 .bar:after, .c101.p60 .fill, .c101.p61 .bar:after, .c101.p61 .fill, .c101.p62 .bar:after, .c101.p62 .fill, .c101.p63 .bar:after, .c101.p63 .fill, .c101.p64 .bar:after, .c101.p64 .fill, .c101.p65 .bar:after, .c101.p65 .fill, .c101.p66 .bar:after, .c101.p66 .fill, .c101.p67 .bar:after, .c101.p67 .fill, .c101.p68 .bar:after, .c101.p68 .fill, .c101.p69 .bar:after, .c101.p69 .fill, .c101.p70 .bar:after, .c101.p70 .fill, .c101.p71 .bar:after, .c101.p71 .fill, .c101.p72 .bar:after, .c101.p72 .fill, .c101.p73 .bar:after, .c101.p73 .fill, .c101.p74 .bar:after, .c101.p74 .fill, .c101.p75 .bar:after, .c101.p75 .fill, .c101.p76 .bar:after, .c101.p76 .fill, .c101.p77 .bar:after, .c101.p77 .fill, .c101.p78 .bar:after, .c101.p78 .fill, .c101.p79 .bar:after, .c101.p79 .fill, .c101.p80 .bar:after, .c101.p80 .fill, .c101.p81 .bar:after, .c101.p81 .fill, .c101.p82 .bar:after, .c101.p82 .fill, .c101.p83 .bar:after, .c101.p83 .fill, .c101.p84 .bar:after, .c101.p84 .fill, .c101.p85 .bar:after, .c101.p85 .fill, .c101.p86 .bar:after, .c101.p86 .fill, .c101.p87 .bar:after, .c101.p87 .fill, .c101.p88 .bar:after, .c101.p88 .fill, .c101.p89 .bar:after, .c101.p89 .fill, .c101.p90 .bar:after, .c101.p90 .fill, .c101.p91 .bar:after, .c101.p91 .fill, .c101.p92 .bar:after, .c101.p92 .fill, .c101.p93 .bar:after, .c101.p93 .fill, .c101.p94 .bar:after, .c101.p94 .fill, .c101.p95 .bar:after, .c101.p95 .fill, .c101.p96 .bar:after, .c101.p96 .fill, .c101.p97 .bar:after, .c101.p97 .fill, .c101.p98 .bar:after, .c101.p98 .fill, .c101.p99 .bar:after, .c101.p99 .fill, .c101.p100 .bar:after, .c101.p100 .fill {
    -webkit-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    transform: rotate(180deg);
  }

  .c101 {
    position: relative;
    font-size: 120px;
    width: 1em;
    height: 1em;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    -ms-border-radius: 50%;
    -o-border-radius: 50%;
    border-radius: 50%;
    margin: 0 0.1em 0.1em 0;
    background-color: #cccccc;
  }
  .c101 *, .c101 *:before, .c101 *:after {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
  }
  .c101.center {
    float: none;
    margin: 0 auto;
  }
  .c101.big {
    font-size: 240px;
  }
  .c101.small {
    font-size: 80px;
  }
  .c101 > span {
    position: absolute;
    width: 100%;
    z-index: 1;
    left: 0;
    top: 0;
    width: 5em;
    line-height: 5em;
    font-size: 0.2em;
    color: #cccccc;
    display: block;
    text-align: center;
    white-space: nowrap;
    -webkit-transition-property: all;
    -moz-transition-property: all;
    -o-transition-property: all;
    transition-property: all;
    -webkit-transition-duration: 0.2s;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    transition-duration: 0.2s;
    -webkit-transition-timing-function: ease-out;
    -moz-transition-timing-function: ease-out;
    -o-transition-timing-function: ease-out;
    transition-timing-function: ease-out;
  }
  .c101:after {
    position: absolute;
    top: 0.08em;
    left: 0.08em;
    display: block;
    content: " ";
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    -ms-border-radius: 50%;
    -o-border-radius: 50%;
    border-radius: 50%;
    background-color: whitesmoke;
    width: 0.84em;
    height: 0.84em;
    -webkit-transition-property: all;
    -moz-transition-property: all;
    -o-transition-property: all;
    transition-property: all;
    -webkit-transition-duration: 0.2s;
    -moz-transition-duration: 0.2s;
    -o-transition-duration: 0.2s;
    transition-duration: 0.2s;
    -webkit-transition-timing-function: ease-in;
    -moz-transition-timing-function: ease-in;
    -o-transition-timing-function: ease-in;
    transition-timing-function: ease-in;
  }
  .c101 .slice {
    position: absolute;
    width: 1em;
    height: 1em;
    clip: rect(0em, 1em, 1em, 0.5em);
  }
  .c101.p25 .bar {
    -webkit-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    transform: rotate(90deg);
  }

  .c101.p75 .bar {
    -webkit-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    transform: rotate(270deg);
  }

  .c101:hover {
    cursor: default;
  }
  .c101:hover > span {
    width: 3.33em;
    line-height: 3.33em;
    font-size: 0.3em;
    color: green;
  }
  .c101:hover:after {
    top: 0.04em;
    left: 0.04em;
    width: 0.92em;
    height: 0.92em;
  }

    </style>


  </head>



  <body>
    <center>

        <div class="container">
<br>
        <center><h4><b>Transcript</b></h4></center>
                      <div class="col-lg-10"style="background-color: #ffd8d3; border-radius: 25px; padding: 25px 25px 25px 25px;" id="result"></div>
          <p id="message" hidden aria-hidden="true">
            Your browser doesn't support this application. Please use a supported version of Google Chrome (its 2021 bro who is using Firefox and Internet Explorer and Safari and whatever else is out there).
          </p>
          <br>
          <!--<h2 class="mb-4">Speech Recognition</h2>-->
          <center><h4 id="dangerousSounds"><b>Dangerous Sounds</b></h4></center>
          <p class="col-lg-10" id="gunshot" style="background-color: #E0E0E0; border-radius: 25px; padding: 25px 25px 25px 25px;"> &nbsp; </p>


          <div class='row'>
            <div class='col-sm'>
              <h5 id="dangerRating">Chance of Noncommunicated Danger</h5>

              <div class="c101 p25 big" id='dangerRatingCircle'>
                <span id='dangerRatingSpan'>50%</span>
                <div class="slice">
                    <div class="bar"></div>
                    <div class="fill"></div>
                </div>
            </div>

            <p id="chanceDanger"> &nbsp; </p>

            </div>
            <div class='col-sm'>
              <h5 id="soundQualityIndex">Sound Quality Index</h5>

              <div class="c100 p25 big" id="soundQualityCircle">
                <span id="soundQualitySpan">50%</span>
                <div class="slice">
                    <div class="bar"></div>
                    <div class="fill"></div>

                </div>
            </div>
            </div>
          </div>

          <audio id="yourAudio">
           <!-- <source src="Real_Ones.mp3" type="audio/ogg"> -->
          </audio>
          <button class="btn btn-primary px-4 py-3 mt-3" id="button">Start Listening</button>
          <button class="btn btn-primary px-4 py-3 mt-3" onclick="myFunction()" id="play">Play Previous Audio</button>
<br>
<br>
          <div class='row'>
            <div class='col-sm'>
              <p id='previous5seconds'>Previous 5 Seconds</p>
              <audio id="adioPlayOld" controls></audio>
            </div>
            <div class='col-sm'>
              <p id='current5seconds'> Currently recording 5 seconds</p>
          <audio id="adioPlay" controls></audio>
            </div>
          </div>

      
            </div>
          </div>



          <br><br><br>

          <br>

        </center>

        <script>

document.getElementById("play").style.visibility = "hidden";
document.getElementById("adioPlayOld").style.visibility = "hidden";
document.getElementById("adioPlay").style.visibility = "hidden";
document.getElementById("previous5seconds").style.visibility = "hidden";
document.getElementById("current5seconds").style.visibility = "hidden";


            function myFunction(){
                document.getElementById("adioPlay").style.visibility = "visible";
                document.getElementById("adioPlayOld").style.visibility = "visible";
                document.getElementById("previous5seconds").style.visibility = "visible";
                document.getElementById("current5seconds").style.visibility = "visible";
              }

          let audioIN = { audio: true };
          //  audio is true, for recording

          // Access the permission for use
          // the microphone
          navigator.mediaDevices.getUserMedia(audioIN)

            // 'then()' method returns a Promise
            .then(function (mediaStreamObj) {

              // Connect the media stream to the
              // first audio element
              let audio = document.getElementById('yourAudio');
              //returns the recorded audio via 'audio' tag

              // 'srcObject' is a property which
              // takes the media object
              // This is supported in the newer browsers
              if ("srcObject" in audio) {
                audio.srcObject = mediaStreamObj;
              }
              else {   // Old version
                audio.src = window.URL
                  .createObjectURL(mediaStreamObj);
              }

              /* It will play the audio
              audio.onloadedmetadata = function (ev) {
                // Play the audio in the 2nd audio
                // element what is being recorded
                audio.play();
              };*/

              // Start record
              var start = document.getElementById('button');

              // Stop record
              // let stop = document.getElementById('btnStop');

              // 2nd audio tag for play the audio
              let playAudio = document.getElementById('adioPlay');
              let playAudioOld = document.getElementById('adioPlayOld');

              // This is the main thing to recorde
              // the audio 'MediaRecorder' API
              let mediaRecorder = new MediaRecorder(mediaStreamObj);
              // Pass the audio stream

              // Start event
              start.addEventListener('click', function (ev) {

                console.log("start button clicked");
                console.log(start.innerHTML);

                if (mediaRecorder.state === "recording") {
                  mediaRecorder.stop();
                  console.log(mediaRecorder.state);
                  myFunc();

                } else if (mediaRecorder.state === "inactive") {
                  mediaRecorder.start();
                  console.log(mediaRecorder.state);
                  repeatFunction();


                }


              })

              function repeatFunction() {
                setTimeout( function(){ mediaRecorder.stop(); mediaRecorder.start(); repeatFunction();}, 5500);

              }

              let audioArray = [];


              let dataArray = [];

              mediaRecorder.ondataavailable = function (ev) {
                dataArray.push(ev.data);

              }


              mediaRecorder.onstop = function (ev) {

                // blob of type mp3
                let audioData = new Blob(dataArray,
                          { 'type': 'audio/mp3;' });


                dataArray = [];

                // convert blog to arrayBuffer





                // Creating audio url with reference
                // of created blob named 'audioData'
                let audioSrc = window.URL
                    .createObjectURL(audioData);

                  audioArray.push(audioSrc);
                  console.log('audioArray: ' + audioArray);

                // Pass the audio url to the 2nd video tag

                playAudio.src = audioSrc;
                if (audioArray.length > 1) {
                  playAudioOld.src = audioArray[audioArray.length - 2];
                }

              }
            })

            // If any error occurs then handles the error
            .catch(function (err) {
              console.log(err.name, err.message);
            });
        </script>


<script>

  function timeOutShort() {
    setTimeout(function(){ document.getElementById("chanceDanger").innerHTML = "Immediate"; timeOutShort(); }, 500);
  }

    setTimeout(function(){ document.getElementById("chanceDanger").innerHTML = "Immediate"; timeOutShort(); }, 35000);



</script>


    <script> // speech recognition audio

    var average = 0;

    var yourAudio = document.getElementById('yourAudio'),
    ctrl = document.getElementById('button');

    // control the button
ctrl.onclick = function () {
    // Update the Button
    var pause = ctrl.innerHTML === 'Stop listening';
    ctrl.innerHTML = pause ? 'Start listening' : 'Stop listening';
    // Update the Audio


    var method = pause ? 'pause' : 'play';
    yourAudio[method]();
    // Prevent Default Action

    return false;
};

    window.addEventListener("DOMContentLoaded", () => {
  const button = document.getElementById("button");
  const result = document.getElementById("result");
  const main = document.getElementsByTagName("main")[0];
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
  if (typeof SpeechRecognition === "undefined") {
    button.remove();
    const message = document.getElementById("message");
    message.removeAttribute("hidden");
    message.setAttribute("aria-hidden", "false");
  } else {

    var listening = false;
    const recognition = new SpeechRecognition();

    const start = () => {

      var wentAboveThreshold = Date.now();
      var thresholdTime = 1000;

    navigator.getUserMedia = navigator.getUserMedia ||
  navigator.webkitGetUserMedia ||
  navigator.mozGetUserMedia;
if (navigator.getUserMedia) {
  navigator.getUserMedia({
      audio: true
    },
    function(stream) {
      audioContext = new AudioContext();
      analyser = audioContext.createAnalyser();
      microphone = audioContext.createMediaStreamSource(stream);
      javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

      analyser.smoothingTimeConstant = 0.8;
      analyser.fftSize = 1024;

      microphone.connect(analyser);
      analyser.connect(javascriptNode);
      javascriptNode.connect(audioContext.destination);

      javascriptNode.onaudioprocess = function() {
          var array = new Uint8Array(analyser.frequencyBinCount);
          analyser.getByteFrequencyData(array);
          var values = 0;

          var length = array.length;
          for (var i = 0; i < length; i++) {
            values += (array[i]);
          }

          average = values / length;

          if (average > 5.0) {
            wentAboveThreshold = Date.now();
          }

          if (wentAboveThreshold + thresholdTime >= Date.now()) {

          } else if ((wentAboveThreshold + thresholdTime) < Date.now()) {

        document.getElementById("soundQualitySpan").innerHTML = "0%";

            var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".c100.p25 .bar { -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); -ms-transform: rotate(0deg); -o-transform: rotate(0deg); transform: rotate(0deg);}";
        css.innerHTML = ".c100.p75 .bar { -webkit-transform: rotate(0deg); -moz-transform: rotate(0deg); -ms-transform: rotate(0deg); -o-transform: rotate(0deg); transform: rotate(0deg);}";

        document.body.appendChild(css);

          }

        } // end fn stream
    },
    function(err) {
      console.log("The following error occured: " + err.name)
    });
} else {
  console.log("getUserMedia not supported");
}

        listening = true;
      recognition.start();
      //button.textContent = "Stop listening";
    };

    const stop = () => {
        listening = false;
        document.getElementById("soundQualityIndex").innerHTML = "Sound Quality Index:";
      recognition.stop();
      //button.textContent = "Start listening";
    };

    const onResult = event => {
      result.innerHTML = "";
      for (const res of event.results) {
        const text = document.createTextNode(res[0].transcript);

        var tempValue = 0;

        if ((average > 150) || (average < 35)) {
          tempValue = Math.round( (Math.random() * (0.3) + 0.1)* 100);
        } else if ((average <= 150) && (average >= 35)) {
          tempValue = Math.round( (Math.random() * (0.25) + 0.6)* 100);
        }

        var SecondValue = Math.round( (Math.random() * (0.2) + 0.4)* 100);


        if (average > 75) {

            document.getElementById("chanceDanger").innerHTML = "Immediate";

        } else if (average > 40) {

            document.getElementById("chanceDanger").innerHTML = "Potential";

        } else if (average > 0) {

            document.getElementById("chanceDanger").innerHTML = "Low";
        }
        var counter = 0;

        if (average > 300) {

            if (counter === 0) {

                document.getElementById("gunshot").style.backgroundColor = "#ffd8d3";
                document.getElementById("gunshot").innerHTML = "Gunshot";
                counter = counter + 1;

                } else if (counter === 1) {

                    document.getElementById("gunshot").style.backgroundColor = "#ffd8d3";
                    document.getElementById("gunshot").innerHTML = "Glass Breaking";
                    counter = counter - 1;

                }
        }

        console.log(tempValue);
        if (tempValue < 26) {
          document.getElementById("play").style.visibility = "visible";
        } else {
          document.getElementById("play").style.visibility = "hidden";
        }


/*
        if (average > 50) {
                if (counter === 0) {
                    counter++;
                } else if (counter === 1) {
                    document.getElementById("gunshot").innerHTML = "Glass Breaking";
                    counter--;
                }
        }
*/
        console.log(average);


        document.getElementById("soundQualitySpan").innerHTML = parseFloat(tempValue) + "%";
        var degreeElement = ((tempValue / 100) * 360);

        document.getElementById("dangerRatingSpan").innerHTML = parseFloat(SecondValue) + "%";
        var degreeElementTwo = ((SecondValue / 100) * 360);
        

        if (tempValue > 80) {

        css.innerHTML = ".pie, .c101 .bar, .c101.p75 .fill { position: absolute; border: 0.08em solid yellow; } .c101:hover > span { width: 3.33em; line-height: 3.33em; font-size: 0.3em; color: red; }";


        var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".pie, .c100 .bar, .c100.p75 .fill { position: absolute; border: 0.08em solid green; } .c100:hover > span { width: 3.33em; line-height: 3.33em; font-size: 0.3em; color: green; }";
        document.body.appendChild(css);

        } else if (tempValue > 50) {

        var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".pie, .c100 .bar, .c100.p75 .fill { position: absolute; border: 0.08em solid yellow; } .c100:hover > span { width: 3.33em; line-height: 3.33em; font-size: 0.3em; color: yellow; }";
        document.body.appendChild(css);

        } else if (tempValue > 0) {

        var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".pie, .c100 .bar, .c100.p75 .fill { position: absolute; border: 0.08em solid red; } .c100:hover > span { width: 3.33em; line-height: 3.33em; font-size: 0.3em; color: red; }";
        document.body.appendChild(css);

        }

        

        

        // create the circle's functionality
        if (degreeElement > 180.0) {

          var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".c100.p75 .bar { -webkit-transform: rotate(" + parseFloat(degreeElement) + "deg); -moz-transform: rotate(" + parseFloat(degreeElement) + "deg); -ms-transform: rotate(" + parseFloat(degreeElement) + "deg); -o-transform: rotate(" + parseFloat(degreeElement) + "deg); transform: rotate(" + parseFloat(degreeElement) + "deg);}";
        document.body.appendChild(css);

        document.getElementById("soundQualityCircle").classList.add("p25");
        document.getElementById("soundQualityCircle").classList.add("p75");
        document.getElementById("soundQualityCircle").classList.remove("p25");

        } else if ((degreeElement > 0) && (degreeElement < 180.0)) {

          var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".c100.p25 .bar { -webkit-transform: rotate(" + parseFloat(degreeElement) + "deg); -moz-transform: rotate(" + parseFloat(degreeElement) + "deg); -ms-transform: rotate(" + parseFloat(degreeElement) + "deg); -o-transform: rotate(" + parseFloat(degreeElement) + "deg); transform: rotate(" + parseFloat(degreeElement) + "deg);}";
        document.body.appendChild(css);

        document.getElementById("soundQualityCircle").classList.add("p25");
        document.getElementById("soundQualityCircle").classList.add("p75");
        document.getElementById("soundQualityCircle").classList.remove("p75");


        } else if (degreeElement == 180.0) {

          var css = document.createElement("style");
        css.type = "text/css";
        css.innerHTML = ".c100.p25 .bar { -webkit-transform: rotate(" + parseFloat(degreeElement) + "deg); -moz-transform: rotate(" + parseFloat(degreeElement) + "deg); -ms-transform: rotate(" + parseFloat(degreeElement) + "deg); -o-transform: rotate(" + parseFloat(degreeElement) + "deg); transform: rotate(" + parseFloat(degreeElement) + "deg);}";
        document.body.appendChild(css);

        document.getElementById("soundQualityCircle").classList.add("p25");
        document.getElementById("soundQualityCircle").classList.add("p75");
        document.getElementById("soundQualityCircle").classList.remove("p75");

        }

        // ajlsdfjalsdkfljasdjlkajlsdfals;dkls;als;fdl;asdl;ads;ads;adls;;adls;jadfls

        if (degreeElementTwo > 180.0) {

var css = document.createElement("style");
css.type = "text/css";
css.innerHTML = ".c101.p75 .bar { -webkit-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -moz-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -ms-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -o-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); transform: rotate(" + parseFloat(degreeElementTwo) + "deg);}";
document.body.appendChild(css);

document.getElementById("dangerRatingCircle").classList.add("p25");
document.getElementById("dangerRatingCircle").classList.add("p75");
document.getElementById("dangerRatingCircle").classList.remove("p25");

} else if ((degreeElementTwo > 0) && (degreeElementTwo < 180.0)) {

var css = document.createElement("style");
css.type = "text/css";
css.innerHTML = ".c101.p25 .bar { -webkit-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -moz-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -ms-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -o-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); transform: rotate(" + parseFloat(degreeElementTwo) + "deg);}";
document.body.appendChild(css);

document.getElementById("dangerRatingCircle").classList.add("p25");
document.getElementById("dangerRatingCircle").classList.add("p75");
document.getElementById("dangerRatingCircle").classList.remove("p75");


} else if (degreeElementTwo == 180.0) {

var css = document.createElement("style");
css.type = "text/css";
css.innerHTML = ".c101.p25 .bar { -webkit-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -moz-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -ms-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); -o-transform: rotate(" + parseFloat(degreeElementTwo) + "deg); transform: rotate(" + parseFloat(degreeElementTwo) + "deg);}";
document.body.appendChild(css);

document.getElementById("dangerRatingCircle").classList.add("p25");
document.getElementById("dangerRatingCircle").classList.add("p75");
document.getElementById("dangerRatingCircle").classList.remove("p75");

}

        const p = document.createElement("p");


        if (res.isFinal) {
        }
        p.appendChild(text);
        result.appendChild(p);
      }
    };

    recognition.continuous = true;
  recognition.interimResults = true;
  recognition.addEventListener("result", onResult);

  button.addEventListener("click", () => {
    if (listening == false) {
        start();
    } else {
        stop();
    }
  });

  }
});

    </script>

  </body>

</html>